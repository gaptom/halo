CREATE OR REPLACE FUNCTION pg_catalog.lpad(bigint, integer, varchar)
 RETURNS text
 LANGUAGE sql
 IMMUTABLE STRICT
AS $function$
SELECT pg_catalog.lpad($1::text, $2, $3::text)
$function$


 create or replace procedure get_actural_index_drop()
language plpgsql
as $$
  declare 
    cursor_sql record;
    i int:=0;
begin
for cursor_sql in(
SELECT
    n.nspname AS schemaname,
    i.relname AS indexname  
FROM pg_index x
    JOIN pg_class c ON c.oid = x.indrelid
    JOIN pg_class i ON i.oid = x.indexrelid
    LEFT JOIN pg_namespace n ON n.oid = c.relnamespace
    LEFT JOIN pg_tablespace t ON t.oid = i.reltablespace
WHERE (c.relkind = ANY (ARRAY['r'::"char", 'm'::"char"])) AND i.relkind = 'i'::"char" and n.nspname='infodba'
) loop
 execute 'drop index '||cursor_sql.schemaname||'.'||cursor_sql.indexname||'';
 i=i+1;
 raise notice '%',i;
 commit;
end loop;
end;
$$;
-----------------------------------------------------------------

CREATE OR REPLACE FUNCTION count_records_dynamically() RETURNS VOID AS $$
DECLARE
  cursor_sql RECORD;
  table_count INTEGER;
BEGIN
  FOR cursor_sql IN
    SELECT tablename FROM pg_tables WHERE schemaname = 'public' -- 可以更改为特定的模式或删除该过滤条件以包括所有模式的表
  LOOP
    EXECUTE 'SELECT COUNT(*) FROM ' || cursor_sql.tablename INTO table_count;
    INSERT INTO tmp_table_count (table_name, record_count) VALUES (cursor_sql.tablename, table_count);
  END LOOP;
END;
$$ LANGUAGE plpgsql;
